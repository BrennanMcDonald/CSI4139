{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst isGlob = require(\"is-glob\");\n\nconst _ = require(\"lodash\");\n\nconst micromatch = require(\"micromatch\");\n\nconst url = require(\"url\");\n\nconst errors_1 = require(\"./errors\");\n\nfunction match(context, uri, req) {\n  // single path\n  if (isStringPath(context)) {\n    return matchSingleStringPath(context, uri);\n  } // single glob path\n\n\n  if (isGlobPath(context)) {\n    return matchSingleGlobPath(context, uri);\n  } // multi path\n\n\n  if (Array.isArray(context)) {\n    if (context.every(isStringPath)) {\n      return matchMultiPath(context, uri);\n    }\n\n    if (context.every(isGlobPath)) {\n      return matchMultiGlobPath(context, uri);\n    }\n\n    throw new Error(errors_1.ERRORS.ERR_CONTEXT_MATCHER_INVALID_ARRAY);\n  } // custom matching\n\n\n  if (_.isFunction(context)) {\n    const pathname = getUrlPathName(uri);\n    return context(pathname, req);\n  }\n\n  throw new Error(errors_1.ERRORS.ERR_CONTEXT_MATCHER_GENERIC);\n}\n\nexports.match = match;\n/**\n * @param  {String} context '/api'\n * @param  {String} uri     'http://example.org/api/b/c/d.html'\n * @return {Boolean}\n */\n\nfunction matchSingleStringPath(context, uri) {\n  const pathname = getUrlPathName(uri);\n  return pathname.indexOf(context) === 0;\n}\n\nfunction matchSingleGlobPath(pattern, uri) {\n  const pathname = getUrlPathName(uri);\n  const matches = micromatch([pathname], pattern);\n  return matches && matches.length > 0;\n}\n\nfunction matchMultiGlobPath(patternList, uri) {\n  return matchSingleGlobPath(patternList, uri);\n}\n/**\n * @param  {String} contextList ['/api', '/ajax']\n * @param  {String} uri     'http://example.org/api/b/c/d.html'\n * @return {Boolean}\n */\n\n\nfunction matchMultiPath(contextList, uri) {\n  let isMultiPath = false;\n\n  for (const context of contextList) {\n    if (matchSingleStringPath(context, uri)) {\n      isMultiPath = true;\n      break;\n    }\n  }\n\n  return isMultiPath;\n}\n/**\n * Parses URI and returns RFC 3986 path\n *\n * @param  {String} uri from req.url\n * @return {String}     RFC 3986 path\n */\n\n\nfunction getUrlPathName(uri) {\n  return uri && url.parse(uri).pathname;\n}\n\nfunction isStringPath(context) {\n  return _.isString(context) && !isGlob(context);\n}\n\nfunction isGlobPath(context) {\n  return isGlob(context);\n}","map":null,"metadata":{},"sourceType":"script"}